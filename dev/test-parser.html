<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Theme Parser Test</title>
</head>
<body>
    <h1>Theme Parser Test</h1>
    <button onclick="testParser()">Test Parser</button>
    <pre id="output"></pre>

    <script>
    function parseThemeCSS(cssText) {
        const theme = {
            colors: {},
            rounded: {}
        };
        
        // Extract theme name
        const nameMatch = cssText.match(/name:\s*["']?([^"';]+)["']?/);
        if (nameMatch) {
            theme.name = nameMatch[1].trim();
            theme.key = theme.name.toLowerCase().replace(/[^a-z0-9]/g, '-');
        } else {
            throw new Error('Theme name not found');
        }
        
        // Extract color-scheme
        const schemeMatch = cssText.match(/color-scheme:\s*["']?([^"';]+)["']?/);
        theme.scheme = schemeMatch ? schemeMatch[1].trim() : 'dark';
        
        // Extract colors - improved regex
        const colorPattern = /--color-([a-z0-9-]+):\s*([^;]+);/gi;
        let colorMatch;
        while ((colorMatch = colorPattern.exec(cssText)) !== null) {
            const colorKey = colorMatch[1];
            let colorValue = colorMatch[2].trim();
            
            // Normalize oklch format
            if (colorValue.includes('oklch')) {
                colorValue = colorValue.replace(/oklch\s*\(\s*/g, 'oklch(');
                colorValue = colorValue.replace(/\s+/g, ' ');
                colorValue = colorValue.replace(/\s*\)/g, ')');
            }
            
            theme.colors[colorKey] = colorValue;
        }
        
        // Extract rounded values
        const radiusBox = cssText.match(/--radius-box:\s*([^;]+);/);
        const radiusField = cssText.match(/--radius-field:\s*([^;]+);/);
        
        theme.rounded = {
            box: radiusBox ? radiusBox[1].trim() : '1rem',
            btn: radiusField ? radiusField[1].trim() : '0.5rem',
            badge: radiusBox ? radiusBox[1].trim() : '1rem'
        };
        
        // Validate
        const requiredColors = [
            'base-100', 'base-200', 'base-300', 'base-content',
            'primary', 'primary-content', 'secondary', 'secondary-content',
            'accent', 'accent-content', 'neutral', 'neutral-content',
            'info', 'info-content', 'success', 'success-content',
            'warning', 'warning-content', 'error', 'error-content'
        ];
        
        for (const color of requiredColors) {
            if (!theme.colors[color]) {
                throw new Error(`Missing required color: ${color}`);
            }
        }
        
        theme.description = 'Custom theme';
        
        return theme;
    }

    function testParser() {
        const testInput = `@plugin "daisyui/theme" {
  name: "luxury";
  default: false;
  prefersdark: false;
  color-scheme: "dark";
  --color-base-100: oklch(14.076% 0.004 285.822);
  --color-base-200: oklch(20.219% 0.004 308.229);
  --color-base-300: oklch(23.219% 0.004 308.229);
  --color-base-content: oklch(75.687% 0.123 76.89);
  --color-primary: oklch(100% 0 0);
  --color-primary-content: oklch(20% 0 0);
  --color-secondary: oklch(27.581% 0.064 261.069);
  --color-secondary-content: oklch(85.516% 0.012 261.069);
  --color-accent: oklch(36.674% 0.051 338.825);
  --color-accent-content: oklch(87.334% 0.01 338.825);
  --color-neutral: oklch(24.27% 0.057 59.825);
  --color-neutral-content: oklch(93.203% 0.089 90.861);
  --color-info: oklch(79.061% 0.121 237.133);
  --color-info-content: oklch(15.812% 0.024 237.133);
  --color-success: oklch(78.119% 0.192 132.154);
  --color-success-content: oklch(15.623% 0.038 132.154);
  --color-warning: oklch(86.127% 0.136 102.891);
  --color-warning-content: oklch(17.225% 0.027 102.891);
  --color-error: oklch(71.753% 0.176 22.568);
  --color-error-content: oklch(14.35% 0.035 22.568);
  --radius-box: 1rem;
}`;

        try {
            const result = parseThemeCSS(testInput);
            document.getElementById('output').textContent = 
                '✅ SUCCESS!\n\n' + JSON.stringify(result, null, 2);
        } catch (error) {
            document.getElementById('output').textContent = 
                '❌ ERROR: ' + error.message;
        }
    }
    </script>
</body>
</html>
